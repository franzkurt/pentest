# Instalando pacote no linux

su root 

apt-get update
apt-get install -y curl wget vim

mkdir /etc/prometheus
mkdir /var/lib/prometheus

useradd --no-create-home --shell /bin/false prometheus
useradd --no-create-home --shell /bin/false node_exporter

curl -LO https://github.com/prometheus/prometh...
tar xvf prometheus-2.0.0.linux-amd64.tar.gz

cp prometheus-2.0.0.linux-amd64/prometheus /usr/local/bin/
cp prometheus-2.0.0.linux-amd64/promtool /usr/local/bin/

cp -r prometheus-2.0.0.linux-amd64/consoles /etc/prometheus
cp -r prometheus-2.0.0.linux-amd64/console_libraries /etc/prometheus

rm -rf prometheus-2.0.0.linux-amd64.tar.gz prometheus-2.0.0.linux-amd64

vim /etc/prometheus/prometheus.yml

	global:
	  scrape_interval:     10s
	  evaluation_interval: 20s
	rule_files:
	  - 'alert.rules'
	scrape_configs:
	  - job_name: 'prometheus'
	    scrape_interval: 5s
	    static_configs:
	         - targets: ['localhost:9090']

vim /etc/prometheus/alert.rules

	groups:
	- name: example
	  rules:

	  # Alert for any instance that is unreachable for >5 minutes.
	  - alert: service_down
	    expr: up == 0
	    for: 2m
	    labels:
	      severity: page
	    annotations:
	      summary: "Instance {{ $labels.instance }} down"
	      description: "{{ $labels.instance }} of job {{ $labels.job }} has been down for more than 2 minutes."

	  - alert: high_load
	    expr: node_load1 > 0.5
	    for: 2m
	    labels:
	      severity: page
	    annotations:
	      summary: "Instance {{ $labels.instance }} under high load"
	      description: "{{ $labels.instance }} of job {{ $labels.job }} is under high load."

chown prometheus:prometheus /usr/local/bin/prometheus
chown prometheus:prometheus /usr/local/bin/promtool

chown -R prometheus:prometheus /etc/prometheus
chown -R prometheus:prometheus /var/lib/prometheus

vim /etc/systemd/system/prometheus.service

	[Unit]
	Description=Prometheus
	Wants=network-online.target
	After=network-online.target

	[Service]
	User=prometheus
	Group=prometheus
	Type=simple
	ExecStart=/usr/local/bin/prometheus \
	    --config.file /etc/prometheus/prometheus.yml \
	    --storage.tsdb.path /var/lib/prometheus/ \
	    --web.console.templates=/etc/prometheus/consoles \
	    --web.console.libraries=/etc/prometheus/console_libraries

	[Install]
	WantedBy=multi-user.target
	
systemctl daemon-reload
systemctl start prometheus
systemctl status prometheus

netstat -atunp | grep 9090   
